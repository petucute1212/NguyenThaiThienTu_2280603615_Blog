<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <title>X√¢y d·ª±ng giao th·ª©c truy·ªÅn file trong Java</title>
    <link rel="stylesheet" href="../css/style.css" />
</head>
<body>
    <header>
        <h1>X√¢y d·ª±ng giao th·ª©c truy·ªÅn file gi·ªØa Client v√† Server trong Java</h1>
        <nav><a href="../index.html">‚á† Tr·ªü v·ªÅ trang ch·ªß</a></nav>
    </header>

    <main>
        <p style="color: #d4af37; font-size: 1.1em; margin-bottom: 25px;"><b>üìÖ Ng√†y ƒëƒÉng:</b> 23/10/2025</p>

        <section>
            <h2>1. Gi·ªõi thi·ªáu v·ªÅ truy·ªÅn file qua m·∫°ng</h2>
            <p>
                Trong c√°c h·ªá th·ªëng m·∫°ng, vi·ªác truy·ªÅn t·ªáp tin (file) l√† m·ªôt ch·ª©c nƒÉng quan tr·ªçng ‚Äì 
                t·ª´ FTP server cho ƒë·∫øn h·ªá th·ªëng cloud nh∆∞ Google Drive, Dropbox.  
                M·ª•c ti√™u b√†i n√†y l√† x√¢y d·ª±ng m·ªôt m√¥ h√¨nh ƒë∆°n gi·∫£n: <b>client g·ª≠i file l√™n server</b> ho·∫∑c <b>server g·ª≠i file cho client</b> 
                qua giao th·ª©c TCP.
            </p>
            
            <h3>1.1. ·ª®ng d·ª•ng trong th·ª±c t·∫ø</h3>
            <p>
                Truy·ªÅn file l√† c·ªët l√µi c·ªßa nhi·ªÅu d·ªãch v·ª• ph·ªï bi·∫øn:
            </p>
            <ul>
                <li><b>FTP (File Transfer Protocol):</b> Chuy·ªÉn file gi·ªØa client v√† server</li>
                <li><b>Cloud Storage:</b> Upload/download file l√™n Google Drive, Dropbox</li>
                <li><b>Email Attachments:</b> G·ª≠i ƒë√≠nh k√®m qua SMTP</li>
                <li><b>P2P File Sharing:</b> BitTorrent, eMule</li>
                <li><b>Backup Systems:</b> Sao l∆∞u d·ªØ li·ªáu qua m·∫°ng</li>
                <li><b>Content Delivery:</b> CDN ph·ª•c v·ª• file tƒ©nh</li>
            </ul>
            
            <h3>1.2. C√°c h√¨nh th·ª©c truy·ªÅn file</h3>
            <ul>
                <li><b>Upload (Client ‚Üí Server):</b> Client g·ª≠i file l√™n server</li>
                <li><b>Download (Server ‚Üí Client):</b> Server g·ª≠i file xu·ªëng client</li>
                <li><b>Bi-directional:</b> C√≥ th·ªÉ upload v√† download trong c√πng ·ª©ng d·ª•ng</li>
            </ul>
            
            <h3>1.3. Th√°ch th·ª©c k·ªπ thu·∫≠t</h3>
            <p>
                Khi truy·ªÅn file qua m·∫°ng, ta c·∫ßn x·ª≠ l√Ω:
            </p>
            <ul>
                <li>ƒê·ªçc file d∆∞·ªõi d·∫°ng binary data (byte array)</li>
                <li>Chia nh·ªè file th√†nh c√°c chunk ƒë·ªÉ tr√°nh buffer overflow</li>
                <li>G·ª≠i metadata: t√™n file, k√≠ch th∆∞·ªõc, lo·∫°i file</li>
                <li>X√°c nh·∫≠n nh·∫≠n ƒë∆∞·ª£c file th√†nh c√¥ng</li>
                <li>X·ª≠ l√Ω l·ªói khi k·∫øt n·ªëi b·ªã gi√°n ƒëo·∫°n</li>
                <li>Hi·ªÉn th·ªã ti·∫øn tr√¨nh upload/download cho user</li>
            </ul>
        </section>

        <section>
            <h2>2. Nguy√™n l√Ω truy·ªÅn file qua socket</h2>
            <p>
                Kh√°c v·ªõi truy·ªÅn text, truy·ªÅn file ƒë√≤i h·ªèi x·ª≠ l√Ω d·ªØ li·ªáu nh·ªã ph√¢n (binary data). 
                Quy tr√¨nh truy·ªÅn file qua socket TCP di·ªÖn ra nh∆∞ sau:
            </p>
            
            <h3>2.1. Quy tr√¨nh truy·ªÅn file</h3>
            <ol>
                <li><b>B√™n g·ª≠i:</b> ƒê·ªçc file t·ª´ disk v√†o b·ªô nh·ªõ (FileInputStream)</li>
                <li><b>B√™n g·ª≠i:</b> Chuy·ªÉn ƒë·ªïi th√†nh byte array</li>
                <li><b>B√™n g·ª≠i:</b> G·ª≠i metadata tr∆∞·ªõc (t√™n file, k√≠ch th∆∞·ªõc)</li>
                <li><b>B√™n g·ª≠i:</b> Chia nh·ªè v√† g·ª≠i t·ª´ng chunk qua OutputStream</li>
                <li><b>B√™n nh·∫≠n:</b> Nh·∫≠n metadata ƒë·ªÉ bi·∫øt t√™n file, k√≠ch th∆∞·ªõc</li>
                <li><b>B√™n nh·∫≠n:</b> ƒê·ªçc byte t·ª´ InputStream</li>
                <li><b>B√™n nh·∫≠n:</b> Ghi v√†o FileOutputStream ƒë·ªÉ t·∫°o file m·ªõi</li>
                <li><b>X√°c nh·∫≠n:</b> B√™n nh·∫≠n g·ª≠i th√¥ng b√°o th√†nh c√¥ng</li>
            </ol>
            
            <h3>2.2. C√°c l·ªõp Java s·ª≠ d·ª•ng</h3>
            <ul>
                <li><b>FileInputStream / FileOutputStream:</b> ƒê·ªçc/ghi file t·ª´ disk</li>
                <li><b>DataInputStream / DataOutputStream:</b> G·ª≠i/nh·∫≠n c√°c ki·ªÉu d·ªØ li·ªáu nguy√™n th·ªßy (long, int, byte)</li>
                <li><b>BufferedInputStream / BufferedOutputStream:</b> TƒÉng hi·ªáu su·∫•t v·ªõi buffer</li>
                <li><b>Socket.getInputStream() / getOutputStream():</b> Lu·ªìng d·ªØ li·ªáu qua m·∫°ng</li>
            </ul>
            
            <h3>2.3. Giao th·ª©c truy·ªÅn file</h3>
            <p>
                Hai b√™n ph·∫£i th·ªëng nh·∫•t th·ª© t·ª± truy·ªÅn file:
            </p>
            <ul>
                <li><b>Metadata tr∆∞·ªõc:</b> G·ª≠i t√™n file, k√≠ch th∆∞·ªõc (byte)</li>
                <li><b>File content sau:</b> G·ª≠i n·ªôi dung file t·ª´ng chunk</li>
                <li><b>T√≠n hi·ªáu k·∫øt th√∫c:</b> Khi ƒë√£ g·ª≠i ƒë·ªß s·ªë byte = k√≠ch th∆∞·ªõc file</li>
            </ul>
            
            <h3>2.4. Chia nh·ªè file (Chunking)</h3>
            <p>
                V√¨ buffer c√≥ gi·ªõi h·∫°n (th∆∞·ªùng 8KB - 64KB), ta c·∫ßn chia file th√†nh nhi·ªÅu chunk:
            </p>
            <pre><code>
// V√≠ d·ª•: Chia file 1MB th√†nh chunks 4KB
byte[] buffer = new byte[4096];  // 4KB
int bytesRead;
long totalBytesRead = 0;
long fileSize = file.length();

while (totalBytesRead < fileSize) {
    bytesRead = inputStream.read(buffer);
    outputStream.write(buffer, 0, bytesRead);
    totalBytesRead += bytesRead;
}
</code></pre>
            <p>
                L·ª£i √≠ch c·ªßa chunking:
            </p>
            <ul>
                <li>Ti·∫øt ki·ªám b·ªô nh·ªõ (kh√¥ng c·∫ßn load to√†n b·ªô file v√†o RAM)</li>
                <li>X·ª≠ l√Ω file l·ªõn (h√†ng GB) m√† kh√¥ng b·ªã OutOfMemoryError</li>
                <li>Hi·ªÉn th·ªã ti·∫øn tr√¨nh: bi·∫øt ƒë∆∞·ª£c % ho√†n th√†nh</li>
            </ul>
        </section>

        <section>
            <h2>3. V√≠ d·ª•: Client g·ª≠i file l√™n Server</h2>

            <h3>Server.java</h3>
            <pre><code>
import java.io.*;
import java.net.*;

public class FileServer {
    public static void main(String[] args) throws IOException {
        ServerSocket serverSocket = new ServerSocket(5000);
        System.out.println("Server s·∫µn s√†ng nh·∫≠n file...");

        Socket socket = serverSocket.accept();
        System.out.println("Client ƒë√£ k·∫øt n·ªëi: " + socket.getInetAddress());

        DataInputStream dis = new DataInputStream(socket.getInputStream());
        FileOutputStream fos = new FileOutputStream("received_file.txt");

        // ƒê·ªçc k√≠ch th∆∞·ªõc file
        long fileSize = dis.readLong();
        byte[] buffer = new byte[4096];
        int read;
        long totalRead = 0;

        while ((read = dis.read(buffer, 0, (int)Math.min(buffer.length, fileSize - totalRead))) > 0) {
            fos.write(buffer, 0, read);
            totalRead += read;
            if (totalRead >= fileSize) break;
        }

        System.out.println("ƒê√£ nh·∫≠n file th√†nh c√¥ng.");
        fos.close();
        dis.close();
        socket.close();
        serverSocket.close();
    }
}
            </code></pre>

            <h3>Client.java</h3>
            <pre><code>
import java.io.*;
import java.net.*;

public class FileClient {
    public static void main(String[] args) throws IOException {
        Socket socket = new Socket("localhost", 5000);
        File file = new File("send_this.txt");

        DataOutputStream dos = new DataOutputStream(socket.getOutputStream());
        FileInputStream fis = new FileInputStream(file);

        dos.writeLong(file.length()); // g·ª≠i k√≠ch th∆∞·ªõc file

        byte[] buffer = new byte[4096];
        int read;
        while ((read = fis.read(buffer)) > 0) {
            dos.write(buffer, 0, read);
        }

        System.out.println("ƒê√£ g·ª≠i file th√†nh c√¥ng.");
        fis.close();
        dos.close();
        socket.close();
    }
}
            </code></pre>

            <p>
                Khi ch·∫°y, client s·∫Ω g·ª≠i file <code>send_this.txt</code> t·ªõi server,  
                server s·∫Ω l∆∞u l·∫°i th√†nh <code>received_file.txt</code> trong c√πng th∆∞ m·ª•c.  
                ƒê√¢y l√† nguy√™n l√Ω c∆° b·∫£n c·ªßa m·ªçi h·ªá th·ªëng truy·ªÅn file qua TCP.
            </p>
        </section>

        <section>
            <h2>4. C·∫£i ti·∫øn v√† m·ªü r·ªông</h2>
            <ul>
                <li>Truy·ªÅn nhi·ªÅu file trong c√πng m·ªôt k·∫øt n·ªëi (g·ª≠i k√®m t√™n file tr∆∞·ªõc m·ªói lu·ªìng d·ªØ li·ªáu).</li>
                <li>Th√™m x√°c th·ª±c ng∆∞·ªùi g·ª≠i (login, token).</li>
                <li>Th√™m hi·ªÉn th·ªã ti·∫øn tr√¨nh truy·ªÅn file (% ho√†n th√†nh).</li>
                <li>Th√™m ch·ª©c nƒÉng <b>t·∫£i v·ªÅ t·ª´ server</b> thay v√¨ ch·ªâ g·ª≠i l√™n.</li>
                <li>M√£ h√≥a file b·∫±ng AES tr∆∞·ªõc khi g·ª≠i ƒë·ªÉ b·∫£o m·∫≠t.</li>
            </ul>
        </section>

        <section>
            <h2>5. K·∫øt lu·∫≠n</h2>
            <p>
                Truy·ªÅn file l√† m·ªôt trong nh·ªØng ·ª©ng d·ª•ng thi·∫øt y·∫øu c·ªßa l·∫≠p tr√¨nh m·∫°ng.  
                Khi hi·ªÉu c∆° ch·∫ø byte stream, ta c√≥ th·ªÉ d·ªÖ d√†ng m·ªü r·ªông sang c√°c ·ª©ng d·ª•ng th·ª±c t·∫ø nh∆∞:
            </p>
            <ul>
                <li>H·ªá th·ªëng chia s·∫ª d·ªØ li·ªáu n·ªôi b·ªô.</li>
                <li>M√°y ch·ªß sao l∆∞u t·ª± ƒë·ªông.</li>
                <li>Truy·ªÅn ·∫£nh, video, ho·∫∑c d·ªØ li·ªáu nh·ªã ph√¢n kh√°c.</li>
            </ul>
            <p>
                Trong b√†i ti·∫øp theo, ch√∫ng ta s·∫Ω k·∫øt h·ª£p c√°c ki·∫øn th·ª©c n√†y ƒë·ªÉ <b>x√¢y d·ª±ng m√¥ h√¨nh ‚ÄúMini FTP Server‚Äù</b> ‚Äî 
                n∆°i client c√≥ th·ªÉ g·ª≠i, t·∫£i v√† li·ªát k√™ file tr√™n server qua m·ªôt giao th·ª©c ri√™ng.
            </p>
        </section>
    </main>

    <footer>
        <p><i>¬© 2025 - Blog L·∫≠p Tr√¨nh M·∫°ng v·ªõi Java</i></p>
    </footer>
</body>
</html>
